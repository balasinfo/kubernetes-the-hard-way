# Kubernetes Certificate Health Checker

Author: [mmumshad@gmail.com](mmumshad@gmail.com)
Version: v0.1
[Kubernetes Certification Course](https://kodekloud.com/p/certified-kubernetes-administrator-with-practice-tests)

Use this spreadsheet to gather information to perform health check of Certificates used in a Kubernetes cluster.  A sample set of data is given in the Data sheet. Follow the same procedure.

Use the command `openssl x509 -in <certificate path> -text -noout` to view data about a certificate

## Checks to Perform

1. Make sure the correct CN and ALT names, Organization are present. Specifically for the kube-api server and the nodes(kubelets).
2. Ensure the certificates are not expired.
3. Ensure the certificates are issued by the right CA.
4. Ensure the correct certificate path is provided in the options on the service configuration files

## Verification Table

| Component                    | Type             | Certificate Path                                            | CN Name                                       | ALT Names                                                                                                                                                                          | Organization | Issuer                   | Expiration               | File Type                               | Purpose                                                          | Description                                                                                                               |
| ---------------------------- | ---------------- | ----------------------------------------------------------- | --------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ------------------------ | ------------------------ | --------------------------------------- | ---------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| Certificate Authority        | Server           | /etc/kubernetes/pki/ca.crt                                  | kubernetes                                    |                                                                                                                                                                                    |              | kubernetes               | May  9 11:21:40 2029 GMT | Certificate                             |                                                                  | CA server root certificates for Kubernetes API Server                                                                     |
| Certificate Authority        | Server           | /etc/kubernetes/pki/ca.key                                  |                                               |                                                                                                                                                                                    |              |                          |                          | Key                                     |                                                                  | CA server root certificate key for Kubernetes API Server                                                                  |
| kube-apiserver               | Server           | /etc/kubernetes/pki/apiserver.crt                           | kube-apiserver                                | DNS:master<br>DNS:kubernetes<br>DNS:kubernetes.default<br>DNS:kubernetes.default.svc<br>DNS:kubernetes.default.svc.cluster.local<br>IP Address:10.96.0.1<br>IP Address:172.17.0.27 |              | kubernetes               | Feb 11 05:39:20 2020 GMT | Certificate                             | Server Certificate                                               | Certificate to serve Kube-api server                                                                                      |
| kube-apiserver               | Server           | /etc/kubernetes/pki/apiserver.key                           |                                               |                                                                                                                                                                                    |              |                          |                          | Key                                     | Server Key                                                       | Key to serve Kube-api server                                                                                              |
| kube-apiserver               | Server           | /etc/kubernetes/pki/ca.crt                                  | kubernetes                                    |                                                                                                                                                                                    |              | kubernetes               | Feb  8 05:39:19 2029 GMT | Certificate                             | Server CA Certificate                                            | CA Certificate to validate clients connecting to Kube-API Server                                                          |
| kube-apiserver               | Client (Kubelet) | /etc/kubernetes/pki/apiserver-kubelet-client.crt            | kube-apiserver-kubelet-client                 | system:masters                                                                                                                                                                     | kubernetes   | Feb 11 05:39:20 2020 GMT | Certificate              | Client Cert: Kube API Server to Kubelet | Client Certificate for Kube-API Server to connect to ETCD Server |
| kube-apiserver               | Client (Kubelet) | /etc/kubernetes/pki/apiserver-kubelet-client.key            |                                               |                                                                                                                                                                                    |              |                          | Key                      | Client Key: Kube API Server to Kubelet  | Client Key for Kube-API Server to connect to ETCD Server         |
| kube-apiserver               | Client (Etcd)    | /etc/kubernetes/pki/apiserver-etcd-client.crt               | kube-apiserver-etcd-client                    | system:masters                                                                                                                                                                     | kubernetes   | Feb 11 05:39:22 2020 GMT | Certificate              | Client Cert: Kube API Server to ETCD    | Client Certificate for Kube-API Server to connect to ETCD Server |
| kube-apiserver               | Client (Etcd)    | /etc/kubernetes/pki/apiserver-etcd-client.key               |                                               |                                                                                                                                                                                    |              |                          |                          | Key                                     | Client Key: Kube API Server to ETCD                              | Client Key for Kube-API Server to connect to ETCD Server                                                                  |
| kube-apiserver               | Client (Etcd)    | /etc/kubernetes/pki/etcd/ca.crt                             | kubernetes                                    |                                                                                                                                                                                    |              | kubernetes               | Feb  8 05:39:21 2029 GMT | Certificate                             | Client CA File: Kube API Server to ETCD                          | CA File to validate Kube-API server to ETCD Server Connectivity. The ETCD setup can have a separate CA                    |
| kubelet                      | Server           | /var/lib/kubelet/pki/kubelet.crt                            | [node01@1557660157](mailto:node01@1557660157) |                                                                                                                                                                                    |              |                          | Certificate              |                                         |                                                                  |
| kubelet                      | Server           | /var/lib/kubelet/pki/kubelet.key                            |                                               |                                                                                                                                                                                    |              |                          |                          | Key                                     |                                                                  |                                                                                                                           |
| kubelet                      | Client           | /var/lib/kubelet/pki/kubelet-client-2019-05-12-11-22-38.pem | system:node:node01                            | system:nodes                                                                                                                                                                       | kubernetes   | May 11 11:18:00 2020 GMT | Certificate              |                                         |                                                                  |
| kubelet                      | Client           |                                                             |                                               |                                                                                                                                                                                    |              |                          |                          | Key                                     |                                                                  |                                                                                                                           |
| Certificate Authority (ETCD) | Server           | /etc/kubernetes/pki/etcd/ca.crt                             | kubernetes                                    |                                                                                                                                                                                    |              | kubernetes               | May  9 11:21:42 2029 GMT | Certificate                             |                                                                  | CA Server root certificates for ETCD Server. (This could be the same as kube-api server or a separate one of its own.)    |
| Certificate Authority (ETCD) | Server           | /etc/kubernetes/pki/etcd/ca.key                             |                                               |                                                                                                                                                                                    |              |                          |                          | Key                                     |                                                                  | CA Server root certificate key for ETCD Server. (This could be the same as kube-api server or a separate one of its own.) |
| etcd-server                  |                  |                                                             |                                               |                                                                                                                                                                                    |              |                          |                          | Certificate                             |                                                                  |                                                                                                                           |
| etcd-server                  |                  |                                                             |                                               |                     


Thank you to [Table To Markdown](https://tabletomarkdown.com/convert-spreadsheet-to-markdown/) for a quick conversion